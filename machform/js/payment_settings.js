$(function(){$(".helpmsg").tooltip({position:"bottom center",offset:[10,20],effect:"fade",opacity:0.8,events:{def:"click,mouseout"}});$("#ps_enable_merchant").bind("change",function(){if($(this).prop("checked")==true){$("#ps_main_list").data("payment_properties").enable_merchant=1;$("#ps_main_list li:gt(0)").fadeIn()}else{$("#ps_main_list").data("payment_properties").enable_merchant=0;$("#ps_main_list li:gt(0)").slideUp()}});$("#ps_select_merchant").bind("change",function(){if($(this).val()=="soon"){$(this).val("paypal_standard")}$("#ps_main_list").data("payment_properties").merchant_type=$(this).val()});$("#ps_paypal_email").bind("keyup mouseout change",function(){$("#ps_main_list").data("payment_properties").paypal_email=$(this).val()});$("#ps_paypal_language").bind("change",function(){$("#ps_main_list").data("payment_properties").paypal_language=$(this).val()});$("#ps_currency").bind("change",function(){$("#ps_main_list").data("payment_properties").currency=$(this).val();var a=$(this).find("option:selected").text().split(" - ");$(".ps_td_currency,.symbol").html(a[0])});$("#ps_show_total_amount").bind("change",function(){if($(this).prop("checked")==true){$("#ps_main_list").data("payment_properties").show_total=1;$("#ps_show_total_location_div").slideDown()}else{$("#ps_main_list").data("payment_properties").show_total=0;$("#ps_show_total_location_div").slideUp()}});$("#ps_show_total_location").bind("change",function(){$("#ps_main_list").data("payment_properties").total_location=$(this).val()});$("#ps_enable_recurring").bind("change",function(){if($(this).prop("checked")==true){$("#ps_main_list").data("payment_properties").enable_recurring=1;$("#ps_recurring_div").slideDown()}else{$("#ps_main_list").data("payment_properties").enable_recurring=0;$("#ps_recurring_div").slideUp()}});$("#ps_recurring_cycle").bind("change",function(){$("#ps_main_list").data("payment_properties").recurring_cycle=parseInt($(this).val())});$("#ps_recurring_cycle_unit").bind("change",function(){$("#ps_main_list").data("payment_properties").recurring_unit=$(this).val()});$("#ps_pricing_type").bind("change",function(){if($(this).val()=="fixed"){$("#ps_box_price_variable_amount_div").hide();$("#ps_box_price_fixed_amount_div").fadeIn();$("#ps_main_list").data("payment_properties").price_type="fixed"}else{$("#ps_box_price_fixed_amount_div").hide();$("#ps_box_price_variable_amount_div").fadeIn();$("#ps_main_list").data("payment_properties").price_type="variable"}});$("#ps_price_amount").bind("keyup mouseout change",function(){var a=parseFloat($(this).val());$("#ps_main_list").data("payment_properties").price_amount=a});$("#ps_price_name").bind("keyup mouseout change",function(){$("#ps_main_list").data("payment_properties").price_name=$(this).val()});$("#ps_select_field_prices").bind("change",function(){if($(this).val()==""){return true}var a=parseInt($(this).val());var c="";if($("#ps_box_define_prices").data("field_options")!=null){c=$("#ps_box_define_prices").data("field_options")[a]}var d="";var b=$("#ps_currency option:selected").text().split(" - ");var f=b[0];var g=new Array();if($.isArray(c)){var e="";$.each(c,function(h,i){e+='<tr><td class="ps_td_field_label">'+i.option+'</td><td class="ps_td_field_price"><span class="ps_td_currency">'+f+'</span><input type="text" id="price_'+a+"_"+i.option_id+'" value="0.00" class="element text large"></td></tr>';g[parseInt(i.option_id)]={element_id:a,option_id:parseInt(i.option_id),price:0,element_type:"multi"}});d='<li id="liprice_'+a+'" style="display: none"><table cellspacing="0" width="100%"><thead><tr><td colspan="2"><strong>';d+=$(this).find("option:selected").text();d+='</strong><a class="delete_liprice" id="deleteliprice_'+a+'" href="#"><img src="images/icons/53.png" /></a></td></tr></thead><tbody>';d+=e;d+="</tbody></table></li>"}else{d='<li id="liprice_'+a+'"><table cellspacing="0" width="100%"><thead><tr><td><strong>'+$(this).find("option:selected").text()+'</strong><a class="delete_liprice" id="deleteliprice_'+a+'" href="#"><img src="images/icons/53.png" /></a></td></tr></thead><tbody><tr><td class="ps_td_field_label">Amount will be entered by the client.</td></tr></tbody></table></li>';g.push({element_id:a,option_id:0,price:0,element_type:"price"})}$("#ps_field_assignment").prepend(d);$("#liprice_"+a).fadeIn();$("#liprice_"+a).data("field_price_properties",g);$(this).find("option:selected").remove();if($("#ps_select_field_prices option").length==1){$("#ps_select_field_prices option").text("No More Fields Available")}});$("#ps_field_assignment").delegate("input.text","keyup mouseout change",function(d){var b=$(this).attr("id").split("_");var a=parseInt(b[1]);var c=parseInt(b[2]);$("#liprice_"+a).data("field_price_properties")[c].price=parseFloat($(this).val())});$("#ps_field_assignment").delegate("a.delete_liprice","click",function(c){var b=$(this).attr("id").split("_");var a=b[1];$("#liprice_"+a).fadeOut("slow",function(){$(this).remove()});$("#ps_select_field_prices").append('<option value="'+a+'">'+$(this).prev().text()+"</option>");$('#ps_select_field_prices option[value=""]').text("");return false});$("#button_save_payment").click(function(){if($("#button_save_payment").text()!="Saving..."){$("#button_save_payment").prop("disabled",true);$("#button_save_payment").text("Saving...");$("#button_save_payment").after("<div class='small_loader_box' style='float: right'><img src='images/loader_small_grey.gif' /></div>");var a=$("#ps_field_assignment li");if(a.length>=1){var b=new Array();a.each(function(c){b[c]=$(this).data("field_price_properties")})}$.ajax({type:"POST",async:true,url:"save_payment_settings.php",data:{payment_properties:$("#ps_main_list").data("payment_properties"),field_prices:b},cache:false,global:false,dataType:"json",error:function(f,c,d){alert("Error! Unable to save payment settings. Please try again.")},success:function(c){if(c.status=="ok"){window.location.replace("manage_forms.php?id="+c.form_id+"&hl=1")}else{alert("Error! Unable to save payment settings. Please try again.")}}})}return false})});